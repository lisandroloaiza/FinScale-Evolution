# 2.1 Core Domain Chart

> **Objetivo**: Clasificar los subdominios del negocio en Core (diferenciadores), Supporting (necesarios) y Generic (commodity).  
> **TÃ©cnica**: Domain-Driven Design (DDD) - Core Domain Chart  
> **MetodologÃ­a**: WhyDD

---

## ðŸŽ¯ Â¿QuÃ© es el Core Domain?

El **Core Domain** es la parte del negocio que proporciona **ventaja competitiva** y donde la empresa debe invertir la mayor parte de sus recursos de desarrollo. Los subdominios se clasifican en:

| Tipo | DescripciÃ³n | Estrategia de Desarrollo |
|------|-------------|--------------------------|
| **Core** | Diferenciador competitivo, lo que hace Ãºnica a FinScale | Desarrollo interno, equipos senior, inversiÃ³n alta |
| **Supporting** | Necesario para el negocio pero no diferenciador | Desarrollo interno o productos listos para usar adaptado |
| **Generic** | Commodity, resuelto en la industria | Comprar soluciÃ³n (SaaS, Open Source) |

---

## ðŸ“Š Core Domain Chart de FinScale

```mermaid
quadrantChart
    title Complejidad vs. Ventaja Competitiva
    x-axis Baja Ventaja Competitiva --> Alta Ventaja Competitiva
    y-axis Baja Complejidad --> Alta Complejidad
    quadrant-1 CORE
    quadrant-2 SUPPORTING
    quadrant-3 GENERIC
    quadrant-4 SUPPORTING
    Position Keeping Ledger: [0.78, 0.92]
    Fraud Detection: [0.80, 0.82]
    Payment Execution: [0.75, 0.72]
    Reconciliation: [0.48, 0.90]
    Clearing Settlement: [0.22, 0.80]
    FX Trading: [0.38, 0.75]
    Liquidity Management: [0.30, 0.65]
    Regulatory Reporting: [0.25, 0.55]
    Customer Onboarding: [0.52, 0.35]
    Beneficiary Management: [0.58, 0.28]
    Sanctions Screening: [0.62, 0.22]
    Wallet Overview: [0.68, 0.18]
    Account Access Auth: [0.18, 0.30]
```

---

## ðŸ”´ Subdominios CORE (Diferenciadores)

### 1. Position Keeping (General Ledger)

**Â¿Por quÃ© es Core?**
- **Diferenciador**: Ledger en tiempo real con consistencia transaccional a escala global es el corazÃ³n de FinScale. Registro inmutable de doble entrada con auditorÃ­a completa.
- **Ventaja Competitiva**: ActualizaciÃ³n de saldos < 1 segundo vs. minutos en competidores. Actualmente 40% de la lÃ³gica reside en PL/SQL Oracle, requiere migraciÃ³n completa.
- **Complejidad TÃ©cnica**: Event Sourcing + CQRS + Consistencia Distribuida + AuditorÃ­a Inmutable + Cumplimiento PCI-DSS (datos financieros sensibles con trazabilidad total y encriptaciÃ³n en reposo/trÃ¡nsito).

**Dominio**: Sistema contable - Mantenimiento de posiciones financieras (Financial Accounting)  
**Modelo de Datos**: Transacciones con doble entrada contable (ID, Cuenta Debe/Haber, Monto, Timestamp atÃ³mico)  
**InversiÃ³n**: ðŸ”´ ALTA - Equipo dedicado de 8-10 desarrolladores senior  
**Estrategia**: REBUILD - Desarrollo interno (Propiedad Intelectual crÃ­tica)

---

### 2. Fraud Detection (Fraud Resolution)

**Â¿Por quÃ© es Core?**
- **Diferenciador**: Motor de detecciÃ³n de fraude en tiempo real con SLA < 100ms. Actualmente 40% de las reglas residen en stored procedures PL/SQL. Detecta patrones anÃ³malos, account takeover y comportamiento fraudulento.
- **Ventaja Competitiva**: Mayor precisiÃ³n en detecciÃ³n (reducciÃ³n de falsos positivos) permite aprobar mÃ¡s transacciones legÃ­timas, incrementando revenue sin aumentar riesgo.
- **Complejidad TÃ©cnica**: MigraciÃ³n de lÃ³gica PL/SQL a arquitectura reactiva + Feature Engineering + Model Serving en tiempo real + Streaming Analytics + Cumplimiento GDPR (procesamiento de datos personales y de comportamiento con derecho al olvido).

**Dominio**: GestiÃ³n de riesgo y prevenciÃ³n de fraude (Fraud Resolution)  
**Modelo de Datos**: Velocity scoring, GeolocalizaciÃ³n (IP vs GPS), Patrones histÃ³ricos de comportamiento, Risk scoring  
**InversiÃ³n**: ðŸ”´ ALTA - Equipo especializado ML + Data Engineers  
**Estrategia**: REBUILD - Servicio independiente con ML en tiempo real

---

### 3. Payment Execution (Payment Order)

**Â¿Por quÃ© es Core?**
- **Diferenciador**: Motor de orquestaciÃ³n de pagos globales con validaciÃ³n de saldo, reserva de fondos y routing inteligente a 50+ redes bancarias internacionales.
- **Ventaja Competitiva**: Escalabilidad extrema 2Kâ†’1M TPS (aumento 500x). ReducciÃ³n de latencia P99: 1.2sâ†’200ms. Routing dinÃ¡mico con fallback automÃ¡tico entre redes.
- **Complejidad TÃ©cnica**: Arquitectura reactiva no bloqueante + OrquestaciÃ³n de sagas distribuidas + Manejo de estados con Event Sourcing + Integraciones heterogÃ©neas (SWIFT, SEPA, PIX, SPEI) + Cumplimiento PCI-DSS (datos de pago con tokenizaciÃ³n y HSM para firmas criptogrÃ¡ficas).

**Dominio**: Operaciones globales - EjecuciÃ³n y orquestaciÃ³n de pagos (Payment Order Management)  
**Modelo de Datos**: Orden de pago (Monto, Divisas origen/destino, Partes: Ordenante/Beneficiario, Fecha valor, Metadata de referencia)  
**InversiÃ³n**: ðŸ”´ ALTA - Equipo core de pagos  
**Estrategia**: REBUILD - Arquitectura reactiva desde cero

---

## ðŸŸ  Subdominios SUPPORTING - Alta Complejidad

### 4. Reconciliation (Reconciliation)

**Â¿Por quÃ© es Supporting?**
- **Necesario**: AuditorÃ­a financiera y compliance regulatorio requieren reconciliaciÃ³n perfecta. Proceso batch actual (00:00-06:00 UTC) bloquea base de datos por 6 horas, impidiendo operaciÃ³n 24/7.
- **No diferenciador**: Proceso estÃ¡ndar de matching de transacciones contra extractos bancarios externos.
- **Complejidad TÃ©cnica**: Alta - Volumen masivo de datos, parseo de formatos bancarios heterogÃ©neos (MT940/CAMT.053), gestiÃ³n de desviaciones crÃ­ticas, alertas automÃ¡ticas para auditorÃ­a financiera.

**Dominio**: Sistema contable - ReconciliaciÃ³n automÃ¡tica  
**Modelo de Datos**: Extractos bancarios (MT940/CAMT.053 de bancos corresponsales), Registros ledger interno, Reportes de desviaciones  
**InversiÃ³n**: ðŸŸ  MEDIA  
**Estrategia**: REBUILD - ReconciliaciÃ³n continua (streaming) para eliminar batch window

---

### 5. FX Trading (Currency Exchange)

**Â¿Por quÃ© es Supporting?**
- **Necesario**: Pagos transfronterizos requieren conversiÃ³n de divisas obligatoria. Sistema debe cotizar tasa de cambio en tiempo real y bloquearla por perÃ­odo definido antes de ejecuciÃ³n.
- **No diferenciador**: Tasas de cambio son determinadas por el mercado (spot rate). El spread aplicado es prÃ¡ctica estÃ¡ndar de la industria.
- **Complejidad TÃ©cnica**: Media - IntegraciÃ³n con proveedores de liquidez FX, mecanismo de bloqueo temporal de tasas, gestiÃ³n de riesgo cambiario.

**Dominio**: Operaciones globales - Trading de divisas (Currency Exchange)  
**Modelo de Datos**: Pares de divisas (ej. USD/EUR), Spread comercial aplicado, Tasa spot del mercado, Timestamp de bloqueo de tasa  
**InversiÃ³n**: ðŸŸ  MEDIA  
**Estrategia**: OPTIMIZE - LÃ³gica interna + integraciÃ³n con brokers FX externos

---

### 6. Clearing & Settlement (Correspondent Bank Ops)

**Â¿Por quÃ© es Supporting?**
- **Necesario**: ComunicaciÃ³n con redes bancarias externas (SWIFT, SEPA, ACH locales) para clearing y liquidaciÃ³n final de fondos.
- **No diferenciador**: Protocolos son estÃ¡ndares industriales (ISO 20022 para SEPA, ISO 8583 sobre TCP para redes de tarjetas).
- **Complejidad TÃ©cnica**: Media-Alta - Protocolos stateful legacy, conexiones TCP persistentes, procesamiento de archivos batch, manejo de ACKs y confirmaciones de red.

**Dominio**: Operaciones globales - CompensaciÃ³n y liquidaciÃ³n con bancos corresponsales  
**Modelo de Datos**: Mensajes ISO 20022 (pacs.008 para pagos, pacs.002 para confirmaciones), Archivos batch para redes legacy, ACKs de red  
**InversiÃ³n**: ðŸŸ  MEDIA  
**Estrategia**: MODERNIZE - Wrapper/Adapter pattern sobre protocolos legacy + Event Streaming

---

### 7. Liquidity Management (Treasury)

**Â¿Por quÃ© es Supporting?**
- **Necesario**: Monitoreo continuo de cuentas de FinScale en bancos corresponsales para garantizar liquidez suficiente y evitar descubiertos.
- **No diferenciador**: Proceso de tesorerÃ­a estÃ¡ndar. Alertas de umbrales y descubiertos son prÃ¡ctica comÃºn.
- **Complejidad TÃ©cnica**: Media - IntegraciÃ³n con mÃºltiples bancos corresponsales, pronÃ³sticos de cash-flow intradÃ­a, sistema de alertas automÃ¡ticas.

**Dominio**: Operaciones globales - GestiÃ³n de tesorerÃ­a y liquidez  
**Modelo de Datos**: Saldos en cuentas de bancos corresponsales, Proyecciones de cash-flow intradÃ­a, ConfiguraciÃ³n de umbrales, Alertas de descubierto  
**InversiÃ³n**: ðŸŸ  MEDIA  
**Estrategia**: OPTIMIZE - Dashboards en tiempo real con alertas proactivas

---

### 10. Regulatory Reporting (Regulatory Compliance)

**Â¿Por quÃ© es Supporting?**
- **Necesario**: GeneraciÃ³n de reportes regulatorios para bancos centrales, autoridades fiscales y entidades de supervisiÃ³n financiera. Logs de transacciones enriquecidos con trazabilidad completa de fondos.
- **No diferenciador**: Formatos de reportes son definidos por reguladores (estÃ¡ndares por paÃ­s/regiÃ³n).
- **Complejidad TÃ©cnica**: Media - Enriquecimiento de datos transaccionales, adaptaciÃ³n a formatos especÃ­ficos por jurisdicciÃ³n, generaciÃ³n de reportes de operaciones sospechosas (ROS) + Cumplimiento PCI-DSS/GDPR (gobierno de datos con trazabilidad total y data lineage para auditorÃ­as).

**Dominio**: Riesgo y cumplimiento - Reportes regulatorios  
**Modelo de Datos**: Logs de transacciones enriquecidos, Trazabilidad de origen y destino de fondos, Reportes de operaciones sospechosas, Datos de clientes (KYC)  
**InversiÃ³n**: ðŸŸ  MEDIA  
**Estrategia**: TRANSFORM - AutomatizaciÃ³n completa con validaciÃ³n pre-envÃ­o

---

## ðŸŸ¡ Subdominios SUPPORTING - Baja Complejidad

### 8. Customer Onboarding

**Â¿Por quÃ© es Supporting?**
- **Necesario**: Proceso de registro de clientes (personas y empresas) con captura de biometrÃ­a y validaciÃ³n de documentos legales. IntegraciÃ³n con proveedores KYC especializados (Jumio, Onfido) mediante webhooks asincrÃ³nicos.
- **No diferenciador**: Proveedores KYC son los mismos utilizados por toda la industria fintech. La lÃ³gica propia es Ãºnicamente orquestaciÃ³n de llamados.
- **Complejidad TÃ©cnica**: Baja - OrquestaciÃ³n de proveedores externos mediante webhooks asincrÃ³nicos, gestiÃ³n de estados del proceso + Cumplimiento GDPR (procesamiento de PII sensible: biometrÃ­a, documentos de identidad, datos fiscales con consentimiento explÃ­cito y derecho al olvido).

**Dominio**: AdquisiciÃ³n y experiencia de cliente - Registro de nuevos usuarios  
**Modelo de Datos**: Documentos de identidad (fotos), Selfies biomÃ©tricos, Datos fiscales (RUT/TaxID), DirecciÃ³n fÃ­sica, Estructura accionaria (para clientes B2B)  
**InversiÃ³n**: ðŸŸ¡ BAJA  
**Estrategia**: OPTIMIZE - OrquestaciÃ³n simple + servicios KYC SaaS

---

### 12. Beneficiary Management (Party Data)

**Â¿Por quÃ© es Supporting?**
- **Necesario**: GestiÃ³n de terceros beneficiarios frecuentes para transferencias.
- **No diferenciador**: Operaciones CRUD estÃ¡ndar, requiere validaciÃ³n especÃ­fica por jurisdicciÃ³n mediante servicios externos.
- **Complejidad TÃ©cnica**: Baja - CRUD con validaciones asÃ­ncronas multi-formato (IBAN/SWIFT/ACH) contra servicios externos de validaciÃ³n.

**Dominio**: AdquisiciÃ³n y experiencia de cliente - GestiÃ³n de beneficiarios (Party Data)  
**Modelo de Datos**: Alias de beneficiario, IBAN/SWIFT/ACH, Nombre del banco destino, Tipo de relaciÃ³n, PaÃ­s/jurisdicciÃ³n  
**InversiÃ³n**: ðŸŸ¡ BAJA  
**Estrategia**: MODERNIZE - Servicio independiente con validaciÃ³n asÃ­ncrona contra APIs externas

---

### 9. Sanctions Screening (Watchlist Screening)

**Â¿Por quÃ© es Supporting?**
- **Necesario**: VerificaciÃ³n obligatoria de que ordenante y beneficiario no figuren en listas negras internacionales (OFAC, Interpol, listas PEP). Requisito regulatorio crÃ­tico.
- **No diferenciador**: Listas son pÃºblicas y actualizadas por organismos internacionales. Algoritmo de matching (fuzzy search) es estÃ¡ndar.
- **Complejidad TÃ©cnica**: Baja - IntegraciÃ³n con proveedor especializado, cache local de listas, matching de nombres.

**Dominio**: Riesgo y cumplimiento - Screening de sanciones y listas de vigilancia  
**Modelo de Datos**: Nombres completos, Fechas de nacimiento, Nacionalidades, PaÃ­ses de riesgo, Listas PEP (Personas PolÃ­ticamente Expuestas)  
**InversiÃ³n**: ðŸŸ¡ BAJA  
**Estrategia**: OPTIMIZE - Servicio SaaS (World-Check, ComplyAdvantage) + cache local

---

### 11. Wallet Overview (Current Account)

**Â¿Por quÃ© es Supporting?**
- **Necesario**: VisualizaciÃ³n de saldos consolidados en mÃºltiples divisas y movimientos histÃ³ricos desde event store.
- **No diferenciador**: Interfaz de consulta de cuenta corriente, estÃ¡ndar en la industria.
- **Complejidad TÃ©cnica**: Baja - Proyecciones CQRS multi-divisa desde event store.

**Dominio**: AdquisiciÃ³n y experiencia de cliente - Vista de cuenta corriente  
**Modelo de Datos**: ID Cliente, Saldos por divisa, Historial de transacciones (metadata), Estado de cuenta  
**InversiÃ³n**: ðŸŸ¡ BAJA  
**Estrategia**: OPTIMIZE - CQRS con Read Models desnormalizados y optimizados para consulta

---

## ðŸŸ¢ Subdominios GENERIC (Commodity - Comprar)

### 13. Account Access (Authentication)

**Â¿Por quÃ© es Generic?**
- **Commodity**: GestiÃ³n de credenciales, autenticaciÃ³n multifactor (2FA), recuperaciÃ³n de claves y manejo de sesiones. OAuth2/OIDC son protocolos estÃ¡ndar completamente resueltos por la industria.
- **Complejidad TÃ©cnica**: Baja - IntegraciÃ³n con proveedor IdP (Identity Provider)

**Dominio**: AdquisiciÃ³n y experiencia de cliente - AutenticaciÃ³n y acceso  
**Modelo de Datos**: Tokens OAuth2/JWT, Hashes de contraseÃ±as, Device fingerprinting, OTPs, Historial de accesos  
**InversiÃ³n**: ðŸŸ¢ BAJA  
**Estrategia**: BUY - Proveedor SaaS (Auth0, AWS Cognito) o Open Source (Keycloak)

---

## ðŸ“‹ Tabla Resumen: ClasificaciÃ³n de Subdominios

| # | Subdominio | Ãrea de Negocio | Tipo | Complejidad | Ventaja Competitiva | InversiÃ³n | Estrategia |
|---|------------|-----------------|------|-------------|---------------------|-----------|------------|
| 1 | Position Keeping (Ledger) | Sistema Contable | ðŸ”´ Core | Muy Alta | Muy Alta | Alta | REBUILD |
| 2 | Fraud Detection | Riesgo y Cumplimiento | ðŸ”´ Core | Muy Alta | Muy Alta | Alta | REBUILD |
| 3 | Payment Execution | Operaciones Globales | ðŸ”´ Core | Alta | Alta | Alta | REBUILD |
| 4 | Reconciliation | Sistema Contable | ðŸŸ  Supporting | Alta | Baja | Media | REBUILD |
| 5 | FX Trading | Operaciones Globales | ðŸŸ  Supporting | Media | Baja | Media | OPTIMIZE |
| 6 | Clearing & Settlement | Operaciones Globales | ðŸŸ  Supporting | Media-Alta | Baja | Media | MODERNIZE |
| 7 | Liquidity Management | Operaciones Globales | ðŸŸ  Supporting | Media | Baja | Media | OPTIMIZE |
| 8 | Customer Onboarding | AdquisiciÃ³n Cliente | ðŸŸ¡ Supporting | Baja | Baja | Baja | OPTIMIZE |
| 9 | Sanctions Screening | Riesgo y Cumplimiento | ðŸŸ¡ Supporting | Baja | Baja | Baja | OPTIMIZE |
| 10 | Regulatory Reporting | Riesgo y Cumplimiento | ðŸŸ  Supporting | Media | Baja | Media | TRANSFORM |
| 11 | Wallet Overview | AdquisiciÃ³n Cliente | ðŸŸ¡ Supporting | Baja | Media | Baja | OPTIMIZE |
| 12 | Beneficiary Management | AdquisiciÃ³n Cliente | ðŸŸ¡ Supporting | Baja | Media | Baja | MODERNIZE |
| 13 | Account Access (Auth) | AdquisiciÃ³n Cliente | ðŸŸ¢ Generic | Baja | Ninguna | Baja | BUY |

---

## ðŸŽ¯ AsignaciÃ³n de Recursos (Equipos)

### Propuesta de DistribuciÃ³n de Equipos

**Equipos Core (60% de recursos de ingenierÃ­a):**
- **System of Record** (10 devs): Position Keeping (Ledger) + Reconciliation
- **Risk & Compliance** (8 devs): Fraud Detection + Sanctions Screening + Regulatory Reporting
- **Payment Core** (12 devs): Payment Execution + FX Trading

**Equipos Supporting (30% de recursos):**
- **Payment Infrastructure** (6 devs): Clearing & Settlement + Liquidity Management
- **Customer Experience** (5 devs): Onboarding + Account Access + Wallet + Beneficiary Management

**Equipos Platform (10% de recursos):**
- **Platform Engineering** (4 devs): API Gateway + Event Bus + Observability + DevOps

---

## âœ… Conclusiones y Decisiones EstratÃ©gicas

1. **Foco en Core Domains (3 de 13 subdominios totales)**:
   - 60% del esfuerzo de ingenierÃ­a concentrado en: Position Keeping (Ledger), Fraud Detection, Payment Execution
   - Estos 3 subdominios proporcionan ventaja competitiva diferencial vs. competidores en el mercado
   - Requieren REBUILD completo: Arquitectura reactiva + Event Sourcing + EliminaciÃ³n de 40% lÃ³gica PL/SQL

2. **Estrategia Build vs. Buy (basada en anÃ¡lisis de valor)**:
   - **REBUILD (4 subdominios)**: Ledger, Fraud, Payment Execution, Reconciliation - CrÃ­ticos para operaciÃ³n 24/7
   - **MODERNIZE (2 subdominios)**: Clearing & Settlement, Beneficiary Management - Protocolos legacy + wrappers para servicios externos
   - **OPTIMIZE (5 subdominios)**: FX, Liquidity, Onboarding, Sanctions, Wallet - Mejoras incrementales sin reescritura
   - **TRANSFORM (1 subdominio)**: Regulatory Reporting - AutomatizaciÃ³n completa
   - **BUY (1 subdominio)**: Account Access (Auth) - OAuth2/OIDC commodity

3. **DistribuciÃ³n por Ãreas de Negocio**:
   - Sistema Contable: 2 subdominios (Ledger, Reconciliation) - Ledger CORE, Reconciliation tendencia al CORE
   - Riesgo y Cumplimiento: 3 subdominios (Fraud, Sanctions, Regulatory) - Fraud CORE, otros Supporting
   - Operaciones Globales: 4 subdominios (Payment, FX, Clearing, Liquidity) - Payment CORE, otros Supporting
   - AdquisiciÃ³n Cliente: 4 subdominios (Onboarding, Wallet, Beneficiary, Auth) - Supporting excepto Auth (Generic)

4. **Criterios de InversiÃ³n**:
   - **Alta inversiÃ³n (3)**: Core Domains que escalan 2Kâ†’1M TPS y eliminan dependencia de 40% lÃ³gica PL/SQL
   - **Media inversiÃ³n (6)**: Supporting de alta complejidad (Reconciliation, FX, Clearing, Liquidity, Regulatory) - necesarios para cumplimiento y operaciÃ³n continua
   - **Baja inversiÃ³n (4)**: Supporting de baja complejidad (Onboarding, Beneficiary, Sanctions, Wallet) y Generic (Auth)

---

**PrÃ³ximo Paso**: â†’ `2.2-Bounded-Contexts.md` para definir lÃ­mites de contexto y modelo de dominio.

---

**Ãšltima actualizaciÃ³n**: 20 de diciembre de 2025
