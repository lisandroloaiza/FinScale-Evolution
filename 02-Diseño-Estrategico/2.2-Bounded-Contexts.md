# 2.2 Bounded Contexts y DelimitaciÃ³n

> **Objetivo**: Definir los lÃ­mites de contexto (Bounded Contexts) basados en los subdominios identificados en el Core Domain Chart.  
> **TÃ©cnica**: Domain-Driven Design - Strategic Design + Context Mapping  
> **AlineaciÃ³n**: 13 subdominios â†’ 10 Bounded Contexts

---

## ðŸŽ¯ Principios de DelimitaciÃ³n de Contextos

1. **Cada Bounded Context es autÃ³nomo**: Tiene su propio modelo de dominio, base de datos y ciclo de vida de despliegue
2. **Lenguaje Ubiquo consistente**: TÃ©rminos del negocio tienen significado Ãºnico dentro del contexto
3. **Alta cohesiÃ³n, bajo acoplamiento**: Contextos se comunican mediante contratos explÃ­citos (APIs, eventos)
4. **AlineaciÃ³n con subdominios**: Cada contexto mapea a uno o mÃ¡s subdominios relacionados

---

## ðŸ“Š Diagrama de DelimitaciÃ³n de Contextos (Vista General)

```mermaid
graph TB
    subgraph CORE["ðŸ”´ CORE DOMAIN"]
        
        PC[Payment Execution<br/>Context]
        FD[Fraud Detection<br/>Context]
        GL[General Ledger<br/>Context]
    end
    
    subgraph SUPPORTING_HIGH["ðŸŸ  SUPPORTING - Alta Complejidad"]
        RC[Reconciliation<br/>Context]
        CS[Clearing & Settlement<br/>Context]
        TR[Treasury & FX<br/>Context]
        RR[Regulatory Reporting<br/>Context]
    end
    
    subgraph SUPPORTING_LOW["ðŸŸ¡ SUPPORTING - Baja Complejidad"]
        CM[Customer Management<br/>Context]
        SC[Screening & Compliance<br/>Context]
    end
    
    subgraph GENERIC["ðŸŸ¢ GENERIC"]
        IA[Identity & Access<br/>Context]
    end
    
    PC -->|Payment Executed| GL
    PC -->|Risk Assessment| FD
    PC -->|Settlement Request| CS
    PC -->|FX Quote| TR
    GL -->|Ledger Entries| RC
    CS -->|Settlement Events| PC
    CM -->|Customer Data| PC
    SC -->|Screening Result| PC
    IA -->|Authentication| CM
    
    style CORE fill:#ffcccc
    style SUPPORTING_HIGH fill:#ffe6cc
    style SUPPORTING_LOW fill:#fff4cc
    style GENERIC fill:#ccffcc
```

---

## ðŸ“¦ Bounded Contexts Identificados (10 Contextos)

### ðŸ”´ CORE DOMAIN (3 Contextos)

#### 1. Payment Execution Context (CORE)

**Subdominios**: Payment Execution  
**Responsabilidad**: OrquestaciÃ³n del pago con validaciÃ³n de saldo, reserva de fondos y enrutamiento a la red de salida adecuada (SWIFT, SEPA, ACH locales, PIX, SPEI) para procesar pagos en 50 paÃ­ses

**Compliance y Seguridad**:  
- **PCI-DSS**: Este contexto procesa datos de pago sensibles que requieren:
  - TokenizaciÃ³n: No almacenar nÃºmeros de tarjeta completos, solo tokens
  - HSM (Hardware Security Module): MÃ³dulo hardware para firmas criptogrÃ¡ficas de Ã³rdenes
  - EncriptaciÃ³n: AES-256 para datos en reposo + TLS 1.3 para datos en trÃ¡nsito
  - AuditorÃ­a: Logs inmutables de todos los accesos a datos sensibles

**Agregados Principales**:
- `PaymentOrder` (Aggregate Root): Monto, Divisa origen/destino, ID Ordenante, ID Beneficiario, Fecha valor, Metadata de referencia
- `PaymentInstruction`: Instrucciones de routing especÃ­ficas por red
- `PaymentState`: MÃ¡quina de estados (DRAFT â†’ VALIDATED â†’ FX_LOCKED â†’ SENT_TO_GATEWAY â†’ CLEARING â†’ SETTLED / FAILED)

**Lenguaje Ubiquo**: Payment Order, Originator, Beneficiary, Payment Status, Routing, Network Selection, Settlement, Value Date, Clearing Network

**InversiÃ³n**: ðŸ”´ ALTA  
**Estrategia**: REBUILD - Arquitectura reactiva con Event Sourcing para manejo de estados

**Integraciones**:
- **â†’ Fraud Detection**: Solicita risk scoring (sync REST < 50ms)
- **â†’ General Ledger**: Emite eventos `PaymentExecuted` (async)
- **â†’ Clearing & Settlement**: EnvÃ­a instrucciones de liquidaciÃ³n (async)
- **â†’ Treasury & FX**: Solicita cotizaciÃ³n FX (sync REST)
- **â† Customer Management**: Recibe datos de Customer/Beneficiary
- **â† Screening & Compliance**: Recibe resultado de sanctions screening

---

#### 2. Fraud Detection Context (CORE)

**Subdominios**: Fraud Detection  
**Responsabilidad**: DetecciÃ³n de fraude en tiempo real con ML (SLA < 100ms)

**Compliance y Seguridad**:  
- **GDPR**: Este contexto procesa datos personales y de comportamiento que requieren:
  - Derecho al olvido: Implementar anonimizaciÃ³n de datos histÃ³ricos cuando el cliente lo solicite
  - Consentimiento explÃ­cito: Usuario debe aprobar scoring basado en ML
  - RetenciÃ³n limitada: MÃ¡ximo 7 aÃ±os para casos de fraude confirmado, luego anonimizar
  - AuditorÃ­a: Logs de accesos a datos sensibles (patrones transaccionales, geolocalizaciÃ³n, device fingerprinting)

**Agregados Principales**:
- `RiskAssessment` (Aggregate Root): PaymentId, RiskScore (0-100), Factors, Timestamp
- `FraudRule`: Reglas de detecciÃ³n (velocity, geolocation, patterns)
- `FraudCase`: Casos de investigaciÃ³n (manual review)

**Lenguaje Ubiquo**: Risk Score, Fraud Pattern, False Positive, True Positive, Velocity Check, Account Takeover

**InversiÃ³n**: ðŸ”´ ALTA  
**Estrategia**: REBUILD - MigraciÃ³n de PL/SQL a servicio independiente con ML en tiempo real

**Integraciones**:
- **â† Payment Execution**: Recibe solicitud de scoring (sync REST)
- **â†’ General Ledger**: Consulta historial de transacciones (sync REST)

---

#### 3. General Ledger Context (CORE)

**Subdominios**: Position Keeping (Ledger)  
**Responsabilidad**: Contabilidad de doble entrada inmutable en tiempo real

**Compliance y Seguridad**:  
- **PCI-DSS**: Este contexto almacena datos financieros sensibles que requieren:
  - EncriptaciÃ³n: AES-256 para datos en reposo + TLS 1.3 para datos en trÃ¡nsito
  - Event Sourcing: Garantiza log inmutable de todas las transacciones (auditorÃ­a completa)
  - MFA: AutenticaciÃ³n multifactor obligatoria para operaciones administrativas
  - Audit trail: Trazabilidad completa de todas las entradas contables

**Agregados Principales**:
- `LedgerEntry` (Aggregate Root): TransactionId, Debit Account, Credit Account, Amount, Currency, Timestamp
- `Account`: Cuentas contables con balances por divisa
- `Balance`: Saldos agregados (snapshot)

**Lenguaje Ubiquo**: Debit, Credit, Ledger Entry, Immutable Log, Double Entry, Chart of Accounts, Balance

**InversiÃ³n**: ðŸ”´ ALTA  
**Estrategia**: REBUILD - Event Sourcing como fuente de verdad, eliminaciÃ³n de 40% lÃ³gica PL/SQL

**Integraciones**:
- **â† Payment Execution**: Recibe eventos `PaymentExecuted`, `PaymentFailed` (async)
- **â†’ Reconciliation**: Publica eventos de ledger entries (async)
- **â† Fraud Detection**: Consultas de historial transaccional (sync REST)

---

### ðŸŸ  SUPPORTING - Alta Complejidad (4 Contextos)

#### 4. Reconciliation Context

**Subdominios**: Reconciliation  
**Responsabilidad**: ReconciliaciÃ³n continua de transacciones internas vs. extractos bancarios externos

**Agregados Principales**:
- `ReconciliationCase` (Aggregate Root): InternalEntry, ExternalEntry, Status, Variance
- `BankStatement`: Extractos bancarios parseados (MT940/CAMT.053)
- `Discrepancy`: Desviaciones detectadas

**Lenguaje Ubiquo**: Reconciliation Match, Discrepancy, Bank Statement, Variance, MT940, CAMT.053

**InversiÃ³n**: ðŸŸ  MEDIA  
**Estrategia**: REBUILD - Streaming reconciliation para eliminar batch window de 6 horas

**Integraciones**:
- **â† General Ledger**: Consume eventos de ledger entries (async streaming)
- **â† Clearing & Settlement**: Consume extractos bancarios externos (async)

---

#### 5. Clearing & Settlement Context

**Subdominios**: Clearing & Settlement  
**Responsabilidad**: ComunicaciÃ³n con redes bancarias externas (SWIFT, SEPA, ACH locales)

**Agregados Principales**:
- `SettlementInstruction` (Aggregate Root): PaymentId, Network, Message, Status
- `ClearingMessage`: Mensajes ISO 20022 (pacs.008, pacs.002)
- `NetworkConnection`: Conexiones TCP persistentes con redes

**Lenguaje Ubiquo**: SWIFT Message, Clearing Network, Settlement, ISO 20022, ACK, NACK, Correspondent Bank

**InversiÃ³n**: ðŸŸ  MEDIA  
**Estrategia**: MODERNIZE - Wrapper/Adapter pattern sobre protocolos legacy + Event Streaming

**Integraciones**:
- **â† Payment Execution**: Recibe instrucciones de liquidaciÃ³n (async)
- **â†’ Payment Execution**: Emite eventos `SettlementConfirmed`, `SettlementFailed` (async)
- **â†’ Reconciliation**: Publica extractos bancarios (async)
- **â†” External Networks**: ACL para SWIFT, SEPA, PIX (conformist)

---

#### 6. Treasury & FX Context

**Subdominios**: FX Trading, Liquidity Management  
**Responsabilidad**: GestiÃ³n de liquidez y cambio de divisas

**Agregados Principales**:
- `FXRate` (Aggregate Root): CurrencyPair (USD/EUR), SpotRate, Spread, Timestamp, Lock
- `LiquidityPool`: Saldos en bancos corresponsales por divisa
- `TreasuryAccount`: Cuentas de FinScale en bancos corresponsales

**Lenguaje Ubiquo**: FX Rate, Spread, Spot Rate, Liquidity Reserve, Nostro Account, Cash Position, Threshold

**InversiÃ³n**: ðŸŸ  MEDIA  
**Estrategia**: OPTIMIZE - LÃ³gica interna + integraciÃ³n con brokers FX externos

**Integraciones**:
- **â† Payment Execution**: Recibe solicitud de cotizaciÃ³n FX (sync REST)
- **â†” External FX Brokers**: IntegraciÃ³n con proveedores de liquidez (API REST)
- **â†’ Regulatory Reporting**: Publica datos de tesorerÃ­a (async)

---

#### 7. Regulatory Reporting Context

**Subdominios**: Regulatory Reporting  
**Responsabilidad**: GeneraciÃ³n de reportes regulatorios para bancos centrales y autoridades fiscales

**Compliance y Seguridad**:  
- **GDPR**: Anonimizar datos personales (PII - Personally Identifiable Information) en reportes agregados (reemplazar nombres/IDs de clientes con hashes irreversibles)
- **Cumplimiento Regulatorio**: Este contexto genera reportes para bancos centrales y autoridades fiscales que requieren:
  - Data lineage: Rastrear cada campo del reporte hasta su fuente original (trazabilidad completa de transformaciones)
  - RetenciÃ³n obligatoria: Almacenar reportes segÃºn jurisdicciÃ³n (ej: Banco Central Europeo 7 aÃ±os, SEC-USA 10 aÃ±os)
  - ValidaciÃ³n automÃ¡tica: Verificar integridad de datos antes de envÃ­o a reguladores
  - Logs inmutables: Registro permanente de todas las submisiones regulatorias

**Agregados Principales**:
- `RegulatoryReport` (Aggregate Root): ReportType, Jurisdiction, Period, Status, Submission
- `TransactionTrace`: Trazabilidad de origen y destino de fondos
- `SuspiciousActivityReport (SAR)`: Reportes de operaciones sospechosas

**Lenguaje Ubiquo**: Regulatory Report, SAR, Suspicious Transaction, Compliance, Jurisdiction, Central Bank

**InversiÃ³n**: ðŸŸ  MEDIA  
**Estrategia**: TRANSFORM - AutomatizaciÃ³n completa con validaciÃ³n pre-envÃ­o

**Integraciones**:
- **â† General Ledger**: Consume logs de transacciones enriquecidos (async)
- **â† Customer Management**: Consume datos KYC (sync REST)
- **â† Treasury & FX**: Consume datos de tesorerÃ­a (async)

---

### ðŸŸ¡ SUPPORTING - Baja Complejidad (2 Contextos)

#### 8. Customer Management Context

**Subdominios**: Customer Onboarding, Beneficiary Management, Wallet Overview  
**Responsabilidad**: GestiÃ³n del ciclo de vida del cliente y beneficiarios

**Compliance y Seguridad**:  
- **GDPR**: Este contexto procesa PII (Personally Identifiable Information) sensible que requiere:
  - Consentimiento explÃ­cito: Requerido en cada etapa del onboarding (captura biometrÃ­a, documentos, datos fiscales)
  - Derecho al olvido: Anonimizar datos personales manteniendo solo metadatos agregados para auditorÃ­a
  - MinimizaciÃ³n de datos: Almacenar solo lo estrictamente necesario para operaciÃ³n
  - DPA (Data Processing Agreement): Acuerdos contractuales con proveedores KYC (Jumio/Onfido) sobre protecciÃ³n de datos
  - RetenciÃ³n segÃºn jurisdicciÃ³n: Cumplir periodos de almacenamiento requeridos por cada paÃ­s

**Agregados Principales**:
- `Customer` (Aggregate Root): CustomerId, PersonalData, KYCStatus, OnboardingState
- `Beneficiary`: Alias, IBAN/SWIFT/ACH, BankName, Country/Jurisdiction
- `AccountView`: Vista consolidada de saldos y movimientos (CQRS Read Model)

**Lenguaje Ubiquo**: Customer, Onboarding, KYC Status, Account Holder, Beneficiary, Wallet, Account Balance

**InversiÃ³n**: ðŸŸ¡ BAJA  
**Estrategia**: OPTIMIZE - OrquestaciÃ³n de servicios externos (KYC SaaS) + CRUD interno + CQRS Read Models

**Integraciones**:
- **â†” External KYC Providers**: Jumio, Onfido (webhooks asincrÃ³nicos)
- **â†’ Payment Execution**: Publica datos de Customer/Beneficiary (async)
- **â† General Ledger**: Consume eventos para AccountView (async CQRS)
- **â†’ Identity & Access**: Vincula Customer con User Identity (sync REST)

---

#### 9. Screening & Compliance Context

**Subdominios**: Sanctions Screening  
**Responsabilidad**: VerificaciÃ³n de listas negras (OFAC, Interpol, PEP)

**Agregados Principales**:
- `ScreeningCase` (Aggregate Root): EntityId (Customer/Beneficiary), WatchlistMatches, Status
- `WatchlistEntry`: Nombre, DOB, Nationality, ListType (OFAC/PEP)

**Lenguaje Ubiquo**: Sanctions List, PEP, Watchlist, AML Check, Screening Hit, False Match

**InversiÃ³n**: ðŸŸ¡ BAJA  
**Estrategia**: OPTIMIZE - Servicio SaaS (World-Check, ComplyAdvantage) + cache local

**Integraciones**:
- **â† Customer Management**: Recibe solicitud de screening (async)
- **â† Payment Execution**: Recibe solicitud de screening (async)
- **â†’ Payment Execution**: Publica resultado de screening (async)
- **â†” External Screening Providers**: World-Check, ComplyAdvantage (API REST + cache)

---

### ðŸŸ¢ GENERIC (1 Contexto)

#### 10. Identity & Access Context

**Subdominios**: Account Access (Authentication)  
**Responsabilidad**: GestiÃ³n de credenciales, autenticaciÃ³n multifactor (2FA), sesiones

**Agregados Principales**:
- `UserIdentity` (Aggregate Root): UserId, Email, PasswordHash, MFASettings
- `Session`: AccessToken (JWT), RefreshToken, DeviceFingerprint
- `MFAToken`: OTPs, TOTP

**Lenguaje Ubiquo**: User, Authentication, Session, OAuth2, JWT, MFA, Device Fingerprint

**InversiÃ³n**: ðŸŸ¢ BAJA  
**Estrategia**: BUY - Proveedor SaaS (Auth0, AWS Cognito) o Open Source (Keycloak)

**Integraciones**:
- **â†’ Customer Management**: Vincula UserId con CustomerId (sync REST)
- **â†’ Todos los contextos**: ValidaciÃ³n de tokens JWT (stateless)

---

## ðŸ“‹ Tabla Resumen: Subdominios â†’ Bounded Contexts

| # | Subdominio | Bounded Context | Tipo | Estrategia |
|---|------------|-----------------|------|------------|
| 1 | Position Keeping (Ledger) | General Ledger Context | ðŸ”´ Core | REBUILD |
| 2 | Fraud Detection | Fraud Detection Context | ðŸ”´ Core | REBUILD |
| 3 | Payment Execution | Payment Execution Context | ðŸ”´ Core | REBUILD |
| 4 | Reconciliation | Reconciliation Context | ðŸŸ  Supporting | REBUILD |
| 5 | FX Trading | Treasury & FX Context | ðŸŸ  Supporting | OPTIMIZE |
| 6 | Clearing & Settlement | Clearing & Settlement Context | ðŸŸ  Supporting | MODERNIZE |
| 7 | Liquidity Management | Treasury & FX Context | ðŸŸ  Supporting | OPTIMIZE |
| 8 | Customer Onboarding | Customer Management Context | ðŸŸ¡ Supporting | OPTIMIZE |
| 9 | Sanctions Screening | Screening & Compliance Context | ðŸŸ¡ Supporting | OPTIMIZE |
| 10 | Regulatory Reporting | Regulatory Reporting Context | ðŸŸ  Supporting | TRANSFORM |
| 11 | Wallet Overview | Customer Management Context | ðŸŸ¡ Supporting | OPTIMIZE |
| 12 | Beneficiary Management | Customer Management Context | ðŸŸ¡ Supporting | MODERNIZE |
| 13 | Account Access (Auth) | Identity & Access Context | ðŸŸ¢ Generic | BUY |

**ConsolidaciÃ³n**: 13 subdominios â†’ 10 Bounded Contexts  
**Criterio**: Subdominios con alta cohesiÃ³n funcional y lenguaje ubiquo compartido se agrupan en el mismo contexto

---

## ðŸ”— Relaciones entre Contextos (Patrones DDD)

Ver archivo [2.3-Context-Map.md](2.3-Context-Map.md) para el mapa completo de relaciones con patrones especÃ­ficos (Partnership, Customer-Supplier, ACL, OHS, etc.)

---

**PrÃ³ximo Paso**: â†’ [2.3-Context-Map.md](2.3-Context-Map.md) - Context Mapping detallado

---

**Ãšltima actualizaciÃ³n**: 20 de diciembre de 2025
